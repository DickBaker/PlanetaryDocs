@page "/"

@inherits IndexBase
  
<h1>Planetary Docs</h1>
<div class="container fixed">
    <div class="row">
        <div class="col">
            <strong>Search Documents:</strong>
        </div>
    </div>
    <div class="row @(loading ? "loading" : string.Empty)"
         @onkeypress="HandleKeyPress">
        <div class="col-4">
            @if (loading)
            {
                <p>@text</p>
            }
            else
            {
                <input 
                       tabindex="100"
                       @bind-value="text"
                   @bind-value:event="oninput"
                   @ref="inputElem"
                   autofocus
                   placeholder="Enter search text" />
            }
        </div>
        <div class="col-3">
            @if (@loading)
            {
                <p><strong>Alias:</strong>&nbsp;@alias</p>
            }
            else
            {
                <AliasSearch TabIndex="200" @bind-Alias="alias"/>
            }
        </div>
        <div class="col-3">
            @if (loading)
            {
                <p><strong>Tag:</strong>&nbsp;@tag</p>
            }
            else
            {
            <TagSearch TabIndex="300" @bind-Tag="tag" />
            }
        </div>
        <div class="col-2">
            &nbsp;<button tabindex="400"
                          class="btn btn-sm btn-success"
                    @onclick="async () => await SearchAsync()"
                    disabled="@(!CanSearch)">
                Search
            </button>
        </div>
    </div>
    <div class="row">
        <div class="container">
            @if (loading)
            {
                <div class="row">
                    <div class="col-12">
                        <div class="alert alert-warning">🔎 Searching...</div>
                    </div>
                </div>
            }
            @if (docsList != null && !loading)
            {
                <div class="row">
                    <div class="col-12">
                        Search criteria: Alias = '@alias', Tag = '@tag', SearchText = '@text''
                    </div>
                    <div class="col-12">
                        <div class="alert alert-info">
                            @if (docsList.Count < 1)
                            {
                                <span class="oi oi-circle-x"></span>
                                <span>&nbsp;No documents found.</span>
                            }
                            @if (docsList.Count == 1)
                            {
                                <span class="oi oi-circle-check"></span>
                                <span>&nbsp;One document found.</span>
                            }
                            @if (docsList.Count > 1)
                            {
                                <span class="oi oi-circle-check"></span>
                                <span>&nbsp;@docsList.Count documents found.</span>
                            }
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2">
                        &nbsp;
                    </div>
                    <div class="col-4">
                        <b>Alias</b>
                    </div>
                    <div class="col-6">
                        <b>Title</b>
                    </div>
                </div>
                foreach (var doc in docsList)
                {
                    <div @key="doc.Uid" class="row result">
                        <div class="col-2">
                            <a title="Edit document" href="/Edit/@(SafeUid(doc.Uid))">
                                <span class="oi oi-pencil">&nbsp;</span>
                            </a>
                            &nbsp;
                            <a title="View document" href="/View/@(SafeUid(doc.Uid))">
                                <span class="oi oi-eye">&nbsp;</span>
                            </a>
                        </div>
                        <div class="col-4 clickable" @onclick="() => Navigate(doc.Uid)">
                            @doc.AuthorAlias
                        </div>
                        <div class="col-6 clickable" @onclick="() => Navigate(doc.Uid)">
                            @doc.Title
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>