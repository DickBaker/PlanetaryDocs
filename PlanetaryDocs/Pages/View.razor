@page "/View/{Uid}"

@inherits ViewBase 

<div class="container">
    <div class="row">
        <div class="col-12">
            @if (LoadingService.Loading)
            {
                <span class="oi oi-reload"></span><span>&nbsp;Loading...</span>
            }
        </div>
    </div>
    @if (notFound)
    {
        <div class="row">
            <div class="col-12">
                <div class="alert alert-danger">
                    ⚠ Document with id '@_uid' was not found.
                    <a href="/">Click here</a> to return to search.
                </div>
            </div>
        </div>
    }
    @if (!loading && document != null)
    {
        <div class="row">
            @if (audit)
            {
            <div class="col-12">
                <h2>@title</h2>
            </div>
            }
            else
            {
                <div class="col-2">
                    <a href="/Edit/@SafeUid(Uid)"
                       title="Edit">📝 Edit</a>
                </div>
                <div class="col-10">
                    <h2>@title</h2>
                </div>
            }
        </div>
        @if (audit)
        {
            <div class="row">
                <div class="col-12">
                    <div class="alert alert-info">
                        You are viewing an archived version of this document.
                        <button class="btn btn-link" 
                                @onclick="() => BackToMain()">Click here</button>
                        to return to the current version.
                    </div>
                </div>
            </div>
        }
        <div class="row">
            <div class="col-2">
                Author: @document.AuthorAlias
            </div>
            <div class="col-2">
                @if (DateTimeOffset.UtcNow.Ticks >
                 document.PublishDate.Ticks)
                {
                    <span>Published: @document.PublishDate</span>
                }
                else
                {
                    <span>Scheduled: @document.PublishDate</span>
                }
            </div>
            <div class="col-8">
                Tags: @foreach (var tag in document.Tags)
                {
                    <span>'@tag'&nbsp;</span>
                }
            </div>
        </div>
        <div class="row">
            <div class="col-12 text-justify">
                @document.Description
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                @if (!showHistory && !audit)
                {
                    <button class="btn btn-link"
                            @onclick="()=>showHistory=true">
                        Show Audit History
                    </button><span>&nbsp;</span>
                }
                <button class="btn btn-link"
                        @onclick="() => { showMarkdown = !showMarkdown; showHistory = false; }">
                    @toggleText
                </button>
                @if (!showMarkdown)
                {
                    <span>&nbsp;</span>
                    <button class="btn btn-link"
                            @onclick="()=> { previewHtml = !previewHtml; showHistory = false; }">
                        @previewText
                    </button>
                }
            </div>
        </div>
        <div class="row">
                @if (showHistory)
                {
                    <DocHistory Uid="@document.Uid"/>
                }
                else if (showMarkdown)
                {
                    <div class="col-12 code">
                        @document.Markdown
                    </div>
                }
                else if (previewHtml)
                {
                    <div class="col-12">
                        <HtmlPreview Html="@document.Html" />
                    </div>
                }
                else
                {
                    <div class="col-12 code">
                        @document.Html
                    </div>
                }                
        </div>
    }
</div>